.pl 63
.po 0
.he      Notes on CP/M Ver. 2.2 With Discus M26, M10, and M20
.fo                             Page #

    Therå  arå severaì featureó oæ Morro÷ Designó versioî oæ CP/Í 
Ver®  2.² witè whicè useró accustomeä tï singlå densitù CP/Í oî ¸ 
incè driveó maù noô bå familiar®   Iî addition¬  somå explanatioî 
ió  requireä  foò  certaiî utilitù commandó  provideä  bù  Morro÷ 
Designs®  Theså  speciaì  featureó anä  utilitieó  arå  discusseä 
below.


CBIOS

     Thå  CBIOS‚  supplieä  witè CP/Í Ver®  2.²  haó  somå  uniquå 
featureó  whicè  allo÷ useró tï easilù uså  floppù  disketteó  oæ 
differenô densitieó and/oò sectoò sizes®  Thå CBIOS‚ wilì reaä anä 
writå  disketteó formateä iî IBÍ 374° singlå densitù format¬  anä 
IBÍ systeí 3´ doublå densitù format®  Thå compatibilitù witè  IBÍ 
disketteó ió ONLÙ iî thå formattinç information¬  NOÔ iî thå filå 
structure®  Thió  meanó  thaô  thå Disë Jockeù 2Ä  caî  reaä  IBÍ 
diskettes¬ buô softwarå ió needeä tï reaä IBÍ files® Nï changå ió 
necessarù  withiî  thå CBIOS‚ tï allo÷ useró tï reaä and/oò  writå 
anù  oæ thå IBÍ standarä sectoò sizes®  Thå CBIOS‚  alsï  supportó 
singlå  anä doublå sideä drives®  Useró witè doublå sideä  driveó 
musô uså doublå sideä disketteó iî ordeò tï takå advantagå oæ thå 
builô  iî  doublå sideä features®  Iæ singlå sideä disketteó  arå 
useä iî á doublå sideä drive¬  thå singlå sideä parameteró oæ thå 
CBIOS‚  wilì  takå  precedencå oveò thå  doublå  sideä  parameteró 
(threå  milliseconä  seekó  anä  extendeä  storage)®   Thå  CBIOS‚ 
requireó  approximatelù  2Ë  oæ memorù abovå  thå  regulaò  CBIOS‚ 
supplieä bù Digitaì Research®  Thå sourcå foò thå CBIOS‚ ió iî thå 
filå 'CBIOS&.ASM'¬  anä thå sourcå foò thå COLÄ anä WARÍ bootó ió 
iî  thå filå 'ABOOT&.ASM'®  Thå disë parameteò headeró  anä  disë 
parameteò  blockó  requireä bù CP/Í arå hanä codeä iî thå  sourcå 
files®  Thå  filå 'DISKS.ASM§ containó macrï librarù  definitionó 
whicè caî bå substituteä foò thå hanä codeä versionó iæ desired.
     Thå  twï  fileó 'BIOS.COM§ anä 'CBIOS.COM§ arå  exampleó  oæ 
disë anä terminaì I/Ï routineó supplieä bù Digitaì Reasearch.


MOVCPM

     Thå  'MOVCPM.COM§  featurå oæ CP/Í caî bå useä  tï  directlù 
relocatå thå COLÄ anä WARÍ booô programs¬  thå CBIOS‚ ¬  anä CP/M® 
Iæ modificationó arå donå tï anù oæ thå above¬  thå  'MOVCPM.COM§ 
prograí  wilì relocatå alì buô thå modifieä portions®  Follo÷ thå 
procedureó  oî  thå nexô pagå iæ anù oæ thå  abovå  programó  arå 
modified.
     Iæ á relocateä CP/Í prograí ió createä usinç thå command:

     movcpm xx

thå relocateä CP/Í wilì begiî executing®  However¬  thå relocateä 
CP/Í  ió highlù unstable®  Iî particular¬  iæ á warí booô occurs¬ 
thå  systeí  maù noô rebooô properly®  Thió ió noô á buç  iî  thå Š'MOVCPM.COM§ program¬  buô ratheò á functioî oæ thå originaì  anä 
relocateä CP/M's®  Iô ió recommendeä thaô thå followinç procedurå 
bå useä instead:

     movcpm xx *
     sysgen
     cold boot the system.

This will insure that the newly relocated CP/M is stable.
     Foò useró witè thå Discuó Harä Disë System¬ thå 'MOVCPM.COM§ 
prograí relocateó thå CBIOS‚ anä BOOT‚ foò thå Harä Disë version¬ 
NOT‚ foò thå floppù version.


ASSIGNING DENSITY

     Useró familiaò witè thå Lifeboat/Morro÷ Designó 2Ä CP/Í Ver® 
1.´  whï  arå accustomeä tï usinç thå 'DENSITY.COM§ prograí  wilì 
appreciatå  thå  automatiã  determinatioî oæ  thå  densitù  oæ  á 
diskette®  Therå ió nï neeä tï inforí CP/Í Ver® 2.² aheaä oæ timå 
oæ thå densitù oæ á diskette®  Jusô inserô thå diskette¬ thå resô 
ió alì takeî carå of.
     Carå musô bå taken¬  however¬   wheî removinç oò replacinç á 
diskettå  whicè haó alreadù beeî accesseä bù CP/M®  Á disë  reseô 
operatioî shoulä bå performeä bù bù doinç á warí boot¬  oò makinç 
á  BDOÓ  calì  tï reseô thå disë systeí (seå thå  CP/Í  interfacå 
guide).
     Aó theså ne÷ featureó havå beeî addeä thå sizå oæ thå  Cbioó 
haó  growî tï thå poinô wherå thå versioî foò thå doublå  densitù 
controlleò caî nï longeò fiô oî thå firsô twï trackó iæ formatteä 
iî  singlå density®   Thió meanó thaô yoõ caî onlù booô uğ witè á 
diskettå thaô haó beeî formatteä witè 102´ bytå sectors.

FORMATTING A DISKETTE

    Thå commanä filå 'FORMT#.COM§ wilì format¬  oò initialize¬  á 
floppù diskettå iî anù IBÍ standarä format®  Typinç 

                  FORMT#

wilì  executå á prograí thaô wilì inquirå thå sectoò  sizeº  128¬ 
256¬  512¬  oò 1024¬ tï bå formatted¬ anä thå drive-- A¬ B¬ C¬ oò 
D-- wherå thå initializatioî wilì takå place® Thå drivå specifieä 
reflectó  thå floppù driveó only¬  nothinç  else®  Sï  formattinç 
drivå  'A§ formató thå firsô floppù connecteä tï thå Disë  Jockeù 
2D®   Formattinç  á  diskettå  wilì  automaticallù  writå  sectoò 
headeró foò thå selecteä sectoò size®  Iæ iô ió desireä tï formaô 
thå harä disk¬ thå prograí 'FORMATHD.COM§ shoulä bå used.

CAUTION
     Yoõ  musô uså cautioî witè thå FORMATHÄ prograí aó thió  caî 
eraså  thå datá oî thå harä disë anä iô caî noô bå recovered®  Iæ Šyoõ havå tï formaô thå disë thinë abouô whaô ió oî thå harä  disë 
when you use the 'D' option for formating.

     Yoõ  shoulä takå notå thaô iæ youò floppieó havå beeä  addeä 
tï  youò  systeí viá thå INSTALÌ prograí oò thaô theù arå  driveó 
C:¬  D:¬  oò abovå theî thå CP/Í drivå numberó havå nothinç tï dï 
witè FORMT£ anä thaô drivå Á wilì alwayó bå thå firsô floppù disë 
drive.

RECONFIGURING A SYSTEM

     Tï  reconfigurå thå CP/Í systeí foò youò particulaò hardwarå 
thå  'CBIOS&.ASM§  anä 'ABOOT&.ASM§ fileó shoulä bå  modifieä  tï 
meeô  youò  requirements®  Manù parameteró oæ thå  Cbioó  caî  bå 
modifieä bù changinç thå valuå oæ certaiî keù variableó whicè arå 
useä durinç thå assembly®  Foò examplå thå labeì MSIZÅ ió useä tï 
adjusô thå memorù sizå oæ thå reconfigureä CP/M¬  thå labeì FIRSÔ 
is used to specify the ordering of the disk drives, etc.
    Oncå thå 'CBIOS&.ASM§ anä 'ABOOT&.ASM§ fileó havå beeî editeä 
anä  reassembled¬   thå  followinç  procedurå  maù  bå  useä   tï 
incorporatå thå ne÷ driveró intï CP/M:

  -Typå  "TYPÅ ABOOT&.PRN"¬  watcè foò thå labeì "OFFSETB¢ iî thå 
listing¬ anä recorä itó value.

  -Typå "TYPÅ CBIOS&.PRN"¬  watcè foò thå labeì "OFFSETC¢ iî  thå 
listing¬ anä recorä itó value.

  -Typå  "MOVCPÍ xø *"¬  wherå xø representó thå memorù size¬  iî 
kilobytes¬ oæ thå desireä system.

  -Type "SAVE 47 CPMxx.COM", with xx as above.

  -Type "DDT CPMxx.COM", with xx as above.

  -Type "IABOOT&.HEX".

  -Type "ROFFSETB", with OFFSETB value from the step above.

  -Type "ICBIOS&.HEX"

  -Type  "ROFFSETC"¬with OFFSETC value from the steps above.
     
  -Type control C (^C) to return from DDT to CP/M.

  -Typå "SYSGEN".
     CP/Í wilì requesô thå namå oæ thå sourcå drive®   Answeò  bù 
pressinç  returî (aô thió poinô thå sourcå foò thå ne÷  systeí ió 
iî RAÍ memory¬ noô oî thå disë wherå yoõ wanô it).

  -Typå  thå destinatioî drive-- Á througè P®  Bå  carefuì  abouô 
whicè driveó (Harä Disë oò Floppy© arå driveó A, B¬ etc¬  aó thió 
step destroys the original CP/M on the destination drive.Š
  -Reset the system and do a COLD BOOT.

     Aó aî examplå oæ thå relocatioî procedure¬  thå followinç ió 
á samplå configuratioî foò á Cbioó witè 48Ë oæ memory¬  thå  Disë 
Jockeù 2Ä aô 0F800H¬ thå Discuó Harä Disë aô 50H¬ anä Disë Jockeù 
2Ä I/O.

     -Ediô thå 'CBIOS&.ASM§ file¬  makå surå thå followinç labeló 
have these values:

          MSIZE = 48          Specifies 48K of memory.
          FIRST = 1           Specifies Discus Hard Disk drive precedes
                                   the Disk Jockey 2D drives.
          MAXHD = 1           Specifies one Discus Hard Disk drive.
          MAXFFLOP 2          Specifies 2 Disk Jockey 2D drives.
          IOTYPE = 3          Specifies Disk Jockey 2D I/O.
          HDORG = 50H         Discus Hard Disk I/O ports begin at 50H.
          ORIGIN = 0F800H     Disk Jockey 2D begins at 0F800H.

     -Ediô thå 'ABOOT&.ASM§ file¬  makå surå thå followinç labeló 
have these values:

          MSIZE = 48          Specifies 48K of memory.
          FIRST = 1           Specifies Discus Hard Disk drive precedes
                                   the Disk Jockey 2D drives.
          MAXHD = 1           Specifies one Discus Hard Disk drive.
          MAXFFLOP 2          Specifies 2 Disk Jockey 2D drives.
          HDORG = 50H         Discus Hard Disk I/O ports begin at 50H.
          ORIGIN = 0F800H     Disk Jockey 2D begins at 0E000H.

     -Assemble the 'CBIOS&.ASM' file:
          A>MAC CBIOS&

     -Assemble the 'ABOOT&.ASM' file:
          A>MAC ABOOT&

     -Finä  thå valuå oæ thå labeì 'OFFSETB§ iî thå  'ABOOT&.PRN§ 
file.
          A>TYPE ABOOT&.PRN

     Watcè foò thå labeì 'OFFSETB§ tï bå printeä oî thå  console¬ 
record the value, 0D00 in this example.

     -Finä  thå valuå oæ thå labeì 'OFFSETC§ iî thå  'CBIOS&.PRN§ 
file.
          A>TYPE CBIOS&.PRN

     Watcè  foò thå labeì 'OFFSETC§ tï bå printeä oî thå console¬ 
record the value, 7600 in this example.
Š     -Relocate the CCP and BDOS parts of CP/M:

          A>MOVCPM 48 *

     -Save the system image on the disk:

          A>SAVE 47 CPM48.COM

     -Load the system image into memory with DDT:

          A>DDT CPM48.COM
          NEXT     PC
          3000     0100
          -IABOOT&.HEX
          -R0D00
          NEXT     PC
          3000     0000
          -ICBIOS&.HEX
          -R7600
          NEXT     PC
          3000     0000
          -^C
          A>
     
     -Now, write the system image out to the disk:

          A>SYSGEN

Answeò  thå firsô questioî askeä witè á return¬  thå systeí imagå 
ió  iî memory®  Answeò thå seconä questioî witè  thå  destinatioî 
drive for the new system.

     -Reset the system and do a COLD BOOT.


SINGLE COMMAND

    Thå prograí 'SINGLE.COM§ ió oæ interesô mainlù tï thoså useró 
whï  havå onlù á singlå drivå system®   Itó purposå ió  tï  allo÷ 
theså useró tï copù CP/Í fileó betweeî diskettes® Useró witè duaì 
drivå   systemó   caî  perforí  sucè  copieó  fasteò   anä   morå 
convenientlù simplù bù usinç PIP.

    'SINGLE§  operateó  bù interceptinç CP/Í calló tï disë  drivå 
selecô  routines®   Ratheò thaî selectinç á NE×  drive¬  'SINGLE§ 
promptó  thå useò tï placå aî "A¢ oò "B¢ diskettå intï  Drivå  A®  
Iî otheò words¬  'SINGLE§ turnó Drivå Á intï á logicaì duaì drivå 
system®   Thå  user¬  however¬  musô keeğ tracë oæ whicè diskettå  
haó beeî designateä thå "A¢ diskettå anä whicè thå "B¢  diskette®  

    Aó aî example¬  tï copù á filå froí drivå Â tï drivå A¬  givå 
the command:Š
                  SINGLE S

tï  begiî  operatioî  iî  singlå modå (thå "S¢  argumenô  ió  foò 
Start)®   Thå  prograí  wilì  responä  thaô  'SINGLE§  haó   beeî 
installed¬  anä  returî  tï CP/M®   Anù operatioî  thaô  involveó 
changinç  driveó wilì no÷ resulô iî á prompô tï placå thå "A¢  oò 
"B¢  diskettå  intï Drivå A®   Iî ouò example¬  thå "B¢  diskettå 
woulä  bå  thå onå witè thå filå whicè wå wisè tï copù  ontï  thå 
systeí diskette®  Onå coulä no÷ type:

                  PIP A:DEST.FILE=B:SOURCE.FILE[V]

    Dependinç  upoî thå lengtè oæ thå filå tï bå  transferred¬  á 
faiò  numbeò  oæ requestó tï placå thå "A¢ oò "B¢  diskettå  intï 
Drivå  Á  wilì  appeaò untiì thå copù ió  completed®   Aî  entirå 
systeí  disë coulä alsï bå backeä uğ thió way®  Firsô  onå  woulä 
formaô thå destinatioî disk® Next¬ thå command:

                  PIP A:=B:*.*

woulä begiî thå copy®  Thió procesó wilì takå manù manù swapó buô 
wilì  dï  thå job®  Thå numbeò oæ diskettå swapó dependó  oî  thå 
amounô oæ memorù whicè PIP haó tï use¬  anä oî thå amounô oæ datá 
tï bå transferred.

    Iî  general¬  anù CP/Í commanä whicè caî bå useä  iî  regulaò 
modå caî bå useä whilå iî singlå mode®  Therå arå twï exceptions¬ 
however®  Thå 'FORMT#.COM§ program¬ becauså iô makeó direcô calló 
tï Disë Jockeù 2Ä firmware¬  wilì noô functioî properlù iî singlå 
mode¬ anä 'MOVCPM.COM§ becauså oæ memorù relocatioî problems.

    To exit single mode, type:

                  SINGLE E

Thió  wilì returî thå useò tï thå standarä CP/Í systeí  (Thå  "E¢ 
argumenô ió foò End)®   Typinç 'SINGLÅ E' wheî noô iî singlå modå 
wilì reporô aî erroò anä returî withouô anù changå beinç made¬ aó 
wilì typinç 'SINGLÅ S' iæ alreadù iî singlå mode.


REGEN

    Thå  'REGEN.COM§  commanä  regenerateó  CP/Í  singlå  densitù 
disketteó  whicè havå beeî formatteä iî sucè á waù sï thaô iô  ió 
incompatiblå  witè  thå normaì operatioî oæ thå  179±  controlleò 
chiğ (IMSAÉ disketteó iî particulaò havå thió problem).

    Thå  'REGEN§  prograí ió designeä tï bå useä  witè  disketteó 
whicè  havå beeî formatteä incorrectly-- noô witè disketteó  thaô 
havå  beeî partiallù destroyed®   Thå besô symptoí oæ á  diskettå Šthaô  coulä  bå useä witè thå 'REGEN§ prograí ió  thaô  thå  Disë 
Jockeù  1Ä boarä caî reaä iô (thå DJ1Ä doeó noô utilizå thå  179± 
controlleò chip© buô thå Disë Jockeù 2Ä cannot.
   
    Essentially¬  thå  'REGEN§ prograí readó á completå tracë  oæ 
datá  anä  formaô  informatioî  intï  memory¬   filteró  ouô  thå 
formatting¬  re-formató  thå  tracë anä theî re-writeó thå  data®  
Thió  procesó  ió  repeateä untiì thå  wholå  diskettå  haó  beeî 
regenerated®   Thå  originaì  diskettå  ió botè  thå  sourcå  anä 
destinatioî diskette¬ anä musô thereforå bå writå enabled.
    Thå  finaì  resulô shoulä bå á singlå densitù  diskettå  thaô 
ió  readablå  botè oî thå machinå thaô originallù produceä iô  aó 
well as on the Disk Jockey 2D controller.

    Simplù typinç 'REGEN§ wilì invokå thió program® Iô haó enougè 
promptó tï explaiî itó use.


FIRMB

     Thå  filå 'FIRMB.ASM§ containó thå firmwarå sourcå foò  Disë 
Jockeù  2Ä  Modeì Â controller®


BOOTHD

     Thå  prograí  'BOOTHD.COM§ containó á booô strağ loadeò  foò 
thå Discuó Harä Disë controller® 'BOOTHD.COM§ coulä bå programmeä 
intï  á PROÍ sï thaô yoõ coulä booô directlù ontï thå harä  diskó 
withouô havinç tï botheò witè thå floppies.


HDFIRM

     Thå  sourcå  foò á seô oæ lo÷ leveì driveró foò  thå  Discuó 
Harä Disë maù bå founä iî thå filå 'HDFIRM.ASM'®  Thå driveró maù 
bå   useä   bù  applicatioî  programó  whicè  musô  havå   direcô 
interactioî witè thå harä disk'ó hardware.
